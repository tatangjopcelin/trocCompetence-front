<div class="container">
    <h2>Mes √©changes</h2>
  
    <!-- üîÑ Chargement -->
    <div *ngIf="loading">Chargement des √©changes...</div>
  
    <!-- ‚ö†Ô∏è Erreur -->
    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
  
    <!-- ‚úÖ Liste des √©changes -->
    <div *ngIf="!loading && exchanges.length > 0">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>ID</th>
            <th>Utilisateur concern√©</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let e of exchanges">
            <td>{{ e.id }}</td>
            <td>{{ e.user2?.name || 'Inconnu' }}</td>
            <td>{{ e.status }}</td>
            <td>
              <button class="btn btn-primary btn-sm" (click)="viewExchangeDetails(e.id)">Voir</button>
              <button class="btn btn-danger btn-sm" (click)="deleteExchange(e.id)">Supprimer</button>
              <button *ngIf="e.status === 'en attente'" class="btn btn-success btn-sm" (click)="updateStatus(e.id, 'accept√©')">Accepter</button>
              <button *ngIf="e.status === 'accept√©'" class="btn btn-secondary btn-sm" (click)="updateStatus(e.id, 'termin√©')">Terminer</button>
              <button class="btn btn-info btn-sm" (click)="openChat(e.id)">Envoyer un message</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  
    <!-- üö´ Aucun √©change -->
    <div *ngIf="!loading && exchanges.length === 0">
      <p>Aucun √©change trouv√©.</p>
    </div>
  
    <!-- üìÑ D√©tails d‚Äôun √©change s√©lectionn√© -->
    <div *ngIf="selectedExchange" class="card mt-4">
      <div class="card-header">
        <strong>D√©tails de l‚Äô√©change #{{ selectedExchange.id }}</strong>
        <button class="btn btn-sm btn-outline-secondary float-end" (click)="closeDetails()">Fermer</button>
      </div>
      <div class="card-body">
        <p><strong>Statut :</strong> {{ selectedExchange.status }}</p>
        <p><strong>Utilisateur initiateur :</strong> {{ selectedExchange.user1?.name || 'Inconnu' }}</p>
        <p><strong>Utilisateur invit√© :</strong> {{ selectedExchange.user2?.name || 'Inconnu' }}</p>
      </div>
    </div>

    <!-- üí¨ Composant de chat li√© √† un √©change -->
    <app-chat
    *ngIf="chatExchangeId"
    [exchangeId]="chatExchangeId"
    class="mt-4 border rounded p-3"
    ></app-chat>

    <!-- üîí Bouton pour fermer le chat -->
<div *ngIf="chatExchangeId" class="mt-2 text-end">
  <button class="btn btn-outline-secondary btn-sms" (click)="closeChat()">Fermer la messagerie</button>
</div>

  </div>
  